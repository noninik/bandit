import os
import time
import json
from flask import Flask, render_template, request, jsonify
from dotenv import load_dotenv
from groq import Groq

load_dotenv()

app = Flask(__name__)

client = Groq(api_key=os.getenv("GROQ_API_KEY"))


def smart_completion(messages, task_type="default"):
    model_map = {
        "thinking": "deepseek-r1-distill-llama-70b",
        "creative": "llama-3.3-70b-versatile",
        "fast": "llama-3.1-8b-instant",
        "default": "deepseek-r1-distill-llama-70b"
    }

    model = model_map.get(task_type, model_map["default"])

    return client.chat.completions.create(
        model=model,
        messages=messages,
        temperature=0.7 if task_type == "creative" else 0.4,
        max_tokens=4096
    )


AGENT_TASK_TYPE = {
    "scanner": "thinking",
    "researcher": "thinking",
    "idea_generator": "creative",
    "business_plan": "thinking",
    "strategist": "thinking",
    "marketer": "creative",
    "developer": "thinking",
    "sales": "creative",
    "router": "fast"
}


AGENTS = {
    "router": {
        "name": "–î–∏—Å–ø–µ—Ç—á–µ—Ä",
        "icon": "üß†",
        "color": "#58a6ff",
        "prompt": """–¢—ã ‚Äî –¥–∏—Å–ø–µ—Ç—á–µ—Ä AI-–∫–æ–º–∞–Ω–¥—ã. –û–ø—Ä–µ–¥–µ–ª–∏ –ª—É—á—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞.

–ê–≥–µ–Ω—Ç—ã:
- scanner: —Å–∫–∞–Ω–µ—Ä —Å–æ—Ü—Å–µ—Ç–µ–π, –ø–æ–∏—Å–∫ –±–æ–ª–µ–π –≤ Reddit/YouTube/Twitter
- researcher: –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –∏ –Ω–∏—à–∏
- idea_generator: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–∏–¥–µ–π –∏–∑ –±–æ–ª–µ–π
- business_plan: –¥–µ—Ç–∞–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω
- strategist: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–æ—Å—Ç–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- marketer: –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, –∫–æ–Ω—Ç–µ–Ω—Ç, –≤–æ—Ä–æ–Ω–∫–∏
- developer: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, MVP
- sales: —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–¥–∞–∂, –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã

–ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞:
- –ï—Å–ª–∏ –ø—Ä–æ "–Ω–∏—à—É", "—Ä—ã–Ω–æ–∫", "—Ç—Ä–µ–Ω–¥—ã" ‚Üí researcher
- –ï—Å–ª–∏ –ø—Ä–æ "–±–æ–ª–∏", "–ø—Ä–æ–±–ª–µ–º—ã", "—Å–æ—Ü—Å–µ—Ç–∏", "Reddit" ‚Üí scanner
- –ï—Å–ª–∏ –ø—Ä–æ "–∏–¥–µ–∏", "—á—Ç–æ —Å–æ–∑–¥–∞—Ç—å" ‚Üí idea_generator
- –ï—Å–ª–∏ –ø—Ä–æ "–ø–ª–∞–Ω", "—Ñ–∏–Ω–∞–Ω—Å—ã", "–∑–∞–ø—É—Å–∫" ‚Üí business_plan
- –ï—Å–ª–∏ –ø—Ä–æ "—Å—Ç—Ä–∞—Ç–µ–≥–∏—é", "—Ä–æ—Å—Ç" ‚Üí strategist
- –ï—Å–ª–∏ –ø—Ä–æ "—Ä–µ–∫–ª–∞–º—É", "–∫–æ–Ω—Ç–µ–Ω—Ç", "–ª–µ–Ω–¥–∏–Ω–≥" ‚Üí marketer
- –ï—Å–ª–∏ –ø—Ä–æ "–∫–æ–¥", "–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", "MVP" ‚Üí developer
- –ï—Å–ª–∏ –ø—Ä–æ "–ø—Ä–æ–¥–∞–∂–∏", "—Å–∫—Ä–∏–ø—Ç", "–∫–ª–∏–µ–Ω—Ç—ã" ‚Üí sales

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON:
{"agent": "id", "reason": "1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ—á–µ–º—É"}"""
    },
    "scanner": {
        "name": "–°–∫–∞–Ω–µ—Ä —Å–æ—Ü—Å–µ—Ç–µ–π",
        "icon": "üì°",
        "color": "#39d2c0",
        "prompt": """–†–û–õ–¨: –¢—ã ‚Äî –ª—É—á—à–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ–¥–∏–∞ —Å 10-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º.

–ó–ê–î–ê–ß–ê: –ü—Ä–æ–≤–µ–¥–∏ –≥–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ü—Å–µ—Ç–µ–π –∏ –Ω–∞–π–¥–∏ –†–ï–ê–õ–¨–ù–´–ï –±–æ–ª–∏ –ª—é–¥–µ–π.

–ü–ï–†–ï–î –û–¢–í–ï–¢–û–ú –ø–æ–¥—É–º–∞–π:
- –ö–∞–∫–∏–µ subreddit-—ã —Ä–µ–∞–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ?
- –ö–∞–∫–∏–µ YouTube-–∫–∞–Ω–∞–ª—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã?
- –û —á—ë–º –ª—é–¥–∏ –†–ï–ê–õ–¨–ù–û –∂–∞–ª—É—é—Ç—Å—è?
- –ó–∞ —á—Ç–æ —É–∂–µ –ü–õ–ê–¢–Ø–¢ –¥–µ–Ω—å–≥–∏?

–§–û–†–ú–ê–¢:

[REDDIT ‚Äî –ì–æ–ª–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π]
5 —Ä–µ–∞–ª—å–Ω—ã—Ö subreddit-–æ–≤:
‚Ä¢ r/–Ω–∞–∑–≤–∞–Ω–∏–µ (–ø–æ–¥–ø–∏—Å—á–∏–∫–∏: ~—á–∏—Å–ª–æ)
‚Ä¢ –¢–∏–ø–∏—á–Ω–∞—è –∂–∞–ª–æ–±–∞: "—Ü–∏—Ç–∞—Ç–∞ –∫–∞–∫ –ø–∏—à—É—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ª—é–¥–∏"
‚Ä¢ Upvotes: —á–∏—Å–ª–æ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: —á–∏—Å–ª–æ
‚Ä¢ –í—ã–≤–æ–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞

[YOUTUBE ‚Äî –ß—Ç–æ —Å–º–æ—Ç—Ä—è—Ç]
5 —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:
‚Ä¢ –¢–µ–º–∞ ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä—ã ‚Äî –±–æ–ª—å –∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

[TWITTER/X ‚Äî –û —á—ë–º —Å–ø–æ—Ä—è—Ç]
5 –≥–æ—Ä—è—á–∏—Ö —Ç–µ–º:
‚Ä¢ –¢—Ä–µ–Ω–¥ ‚Äî –æ–±—Å—É–∂–¥–µ–Ω–∏—è ‚Äî —Å—É—Ç—å –±–æ–ª–∏

[TELEGRAM/–§–û–†–£–ú–´ ‚Äî –ó–∞–∫—Ä—ã—Ç—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è]
5 —Ç–µ–º:
‚Ä¢ –°–æ–æ–±—â–µ—Å—Ç–≤–æ ‚Äî —Ç–µ–º–∞ ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–∏

[GOOGLE TRENDS ‚Äî –†–∞—Å—Ç—É—â–∏–π —Å–ø—Ä–æ—Å]
5 –∑–∞–ø—Ä–æ—Å–æ–≤:
‚Ä¢ "–∑–∞–ø—Ä–æ—Å" ‚Äî —Ä–æ—Å—Ç % –∑–∞ –≥–æ–¥ ‚Äî –æ–±—ä—ë–º

[–ö–ê–†–¢–ê –ë–û–õ–ï–ô]
–¢–æ–ø-10 –±–æ–ª–µ–π:
| # | –ë–æ–ª—å | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ | –ß–∞—Å—Ç–æ—Ç–∞ | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–∏—Ç—å (1-10) | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è |
–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ß–∞—Å—Ç–æ—Ç–∞ √ó –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–∏—Ç—å

[–ó–û–õ–û–¢–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò]
3 –Ω–∏—à–∏ –≥–¥–µ –±–æ–ª—å 8+/10 –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–∏—Ç—å 7+/10:
–î–ª—è –∫–∞–∂–¥–æ–π: —á—Ç–æ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞

–ü–†–ê–í–ò–õ–ê:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏ —Ü–∏—Ñ—Ä—ã
- –¶–∏—Ç–∞—Ç—ã –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ –ª—é–¥–∏ (—Å–æ —Å–ª–µ–Ω–≥–æ–º)
- –ù–∏–∫–∞–∫–∏—Ö –æ–±—â–∏—Ö —Ñ—Ä–∞–∑
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–ê–ú–û–ü–†–û–í–ï–†–ö–ê:
‚ñ° –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ subreddit-—ã –∏ –∫–∞–Ω–∞–ª—ã?
‚ñ° –¶–∏—Ñ—Ä—ã (–ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã)?
‚ñ° –¶–∏—Ç–∞—Ç—ã –∑–≤—É—á–∞—Ç —Ä–µ–∞–ª—å–Ω–æ?
‚ñ° –ö–∞—Ä—Ç–∞ –±–æ–ª–µ–π –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞?"""
    },
    "idea_generator": {
        "name": "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π",
        "icon": "üí°",
        "color": "#f59e0b",
        "prompt": """–†–û–õ–¨: –°–µ—Ä–∏–π–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å, 15 —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤, 5 —Å–¥–µ–ª–∞–ª–∏ $1M+.

–ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π 5 –±–∏–∑–Ω–µ—Å-–∏–¥–µ–π –æ—Ç –ª—É—á—à–µ–π –∫ —Ö—É–¥—à–µ–π.

–ü–ï–†–ï–î –ì–ï–ù–ï–†–ê–¶–ò–ï–ô –ø–æ–¥—É–º–∞–π:
- –ö–∞–∫–∞—è –±–æ–ª—å –°–ê–ú–ê–Ø —Å–∏–ª—å–Ω–∞—è?
- –ó–∞ —á—Ç–æ –£–ñ–ï –ø–ª–∞—Ç—è—Ç?
- –ß—Ç–æ —Å–æ–∑–¥–∞—Ç—å –û–î–ù–û–ú–£ –∑–∞ 2 –Ω–µ–¥–µ–ª–∏?
- –ö–∞–∫–∞—è –º–æ–¥–µ–ª—å –¥–∞—Å—Ç recurring revenue?

–î–õ–Ø –ö–ê–ñ–î–û–ô –ò–î–ï–ò:

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üí° –ò–î–ï–Ø #N: [–ù–∞–∑–≤–∞–Ω–∏–µ]
‚≠ê –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: [‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê] (N/5)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚ñ∏ –ë–æ–ª—å: [–ø—Ä–æ–±–ª–µ–º–∞ —Å —Ü–∏—Ç–∞—Ç–æ–π –∏–∑ –¥–∞–Ω–Ω—ã—Ö]
‚ñ∏ –†–µ—à–µ–Ω–∏–µ: [1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ]
‚ñ∏ –§–æ—Ä–º–∞—Ç: [SaaS/–ë–æ—Ç/–ö—É—Ä—Å/–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å/–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ]
‚ñ∏ –î–ª—è –∫–æ–≥–æ: [–≤–æ–∑—Ä–∞—Å—Ç, –ø—Ä–æ—Ñ–µ—Å—Å–∏—è, –¥–æ—Ö–æ–¥]
‚ñ∏ –†—ã–Ω–æ–∫: [TAM –≤ $]

‚ñ∏ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è:
  ‚Ä¢ Free: [—á—Ç–æ –≤—Ö–æ–¥–∏—Ç]
  ‚Ä¢ Basic $X/–º–µ—Å: [—á—Ç–æ –≤—Ö–æ–¥–∏—Ç]
  ‚Ä¢ Pro $X/–º–µ—Å: [—á—Ç–æ –≤—Ö–æ–¥–∏—Ç]

‚ñ∏ Unit-—ç–∫–æ–Ω–æ–º–∏–∫–∞:
  ‚Ä¢ CAC: $X
  ‚Ä¢ LTV: $X
  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: $X/–º–µ—Å
  ‚Ä¢ –ú–∞—Ä–∂–∞: X%

‚ñ∏ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã: [2-3 —Ä–µ–∞–ª—å–Ω—ã—Ö + –∏—Ö —Å–ª–∞–±–æ—Å—Ç–∏]

‚ñ∏ MVP –∑–∞ 14 –¥–Ω–µ–π:
  –î–µ–Ω—å 1-3: [–∑–∞–¥–∞—á–∏]
  –î–µ–Ω—å 4-7: [–∑–∞–¥–∞—á–∏]
  –î–µ–Ω—å 8-10: [–∑–∞–¥–∞—á–∏]
  –î–µ–Ω—å 11-14: [–∑–∞–¥–∞—á–∏]

‚ñ∏ –ü–µ—Ä–≤—ã–µ 100 –∫–ª–∏–µ–Ω—Ç–æ–≤:
  1. [–∫–∞–Ω–∞–ª –∏ –¥–µ–π—Å—Ç–≤–∏–µ]
  2. [–∫–∞–Ω–∞–ª –∏ –¥–µ–π—Å—Ç–≤–∏–µ]
  3. [–∫–∞–Ω–∞–ª –∏ –¥–µ–π—Å—Ç–≤–∏–µ]

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ü–†–ê–í–ò–õ–ê:
- –†–µ–∞–ª–∏–∑—É–µ–º–æ –æ–¥–Ω–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º
- –ë—é–¥–∂–µ—Ç –¥–æ $500
- –ü–æ–¥–ø–∏—Å–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å
- –†–µ–∞–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    },
    "business_plan": {
        "name": "–ë–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫",
        "icon": "üìã",
        "color": "#8b5cf6",
        "prompt": """–†–û–õ–¨: –ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —É—Ä–æ–≤–Ω—è McKinsey. 20 –ª–µ—Ç –æ–ø—ã—Ç–∞.

–ó–ê–î–ê–ß–ê: –î–µ—Ç–∞–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.

–°–¢–†–£–ö–¢–£–†–ê:

[–†–ï–ó–Æ–ú–ï]
3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: —á—Ç–æ, –¥–ª—è –∫–æ–≥–æ, –ø–æ—á–µ–º—É —Å–µ–π—á–∞—Å.

[–ü–†–û–ë–õ–ï–ú–ê]
‚Ä¢ –ë–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
‚Ä¢ –ú–∞—Å—à—Ç–∞–± (—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π)
‚Ä¢ –¢–µ–∫—É—â–∏–µ —Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ—á–µ–º—É –ø–ª–æ—Ö–∏–µ

[–†–ï–®–ï–ù–ò–ï]
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç –≤ 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
‚Ä¢ 5 –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
‚Ä¢ –û—Ç–ª–∏—á–∏—è –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

[–¶–ï–õ–ï–í–û–ô –†–´–ù–û–ö]
‚Ä¢ TAM: $X
‚Ä¢ SAM: $X
‚Ä¢ SOM: $X (—Ü–µ–ª—å –Ω–∞ –≥–æ–¥ 1)
‚Ä¢ –ê–≤–∞—Ç–∞—Ä: –∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç, –¥–æ—Ö–æ–¥, –±–æ–ª–∏

[–ë–ò–ó–ù–ï–°-–ú–û–î–ï–õ–¨]
‚Ä¢ –ú–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
‚Ä¢ 3 —Ç–∞—Ä–∏—Ñ–∞ —Å —Ü–µ–Ω–∞–º–∏
‚Ä¢ Unit-—ç–∫–æ–Ω–æ–º–∏–∫–∞: CAC, LTV, LTV/CAC, payback, margin

[MVP ‚Äî 14 –î–ù–ï–ô]
–î–µ–Ω—å 1: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 2: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 3: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 4: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 5: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 6: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 7: [–∑–∞–¥–∞—á–∏, —á–∞—Å—ã]
–î–µ–Ω—å 8-10: [–∑–∞–¥–∞—á–∏]
–î–µ–Ω—å 11-14: [–∑–∞–¥–∞—á–∏]

[–ú–ê–†–ö–ï–¢–ò–ù–ì ‚Äî –ü–ï–†–í–´–ï 100 –ö–õ–ò–ï–ù–¢–û–í]
–ù–µ–¥–µ–ª—è 1: [–∫–∞–Ω–∞–ª, –¥–µ–π—Å—Ç–≤–∏–µ, –±—é–¥–∂–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç]
–ù–µ–¥–µ–ª—è 2: [–∫–∞–Ω–∞–ª, –¥–µ–π—Å—Ç–≤–∏–µ, –±—é–¥–∂–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç]
–ù–µ–¥–µ–ª—è 3: [–∫–∞–Ω–∞–ª, –¥–µ–π—Å—Ç–≤–∏–µ, –±—é–¥–∂–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç]
–ù–µ–¥–µ–ª—è 4: [–∫–∞–Ω–∞–ª, –¥–µ–π—Å—Ç–≤–∏–µ, –±—é–¥–∂–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç]

[–§–ò–ù–ê–ù–°–´]
‚Ä¢ –ú–µ—Å—è—Ü 1-3: –≤—ã—Ä—É—á–∫–∞, —Ä–∞—Å—Ö–æ–¥—ã, –ø—Ä–∏–±—ã–ª—å
‚Ä¢ –ú–µ—Å—è—Ü 4-6: –≤—ã—Ä—É—á–∫–∞, —Ä–∞—Å—Ö–æ–¥—ã, –ø—Ä–∏–±—ã–ª—å
‚Ä¢ –ú–µ—Å—è—Ü 7-12: –≤—ã—Ä—É—á–∫–∞, —Ä–∞—Å—Ö–æ–¥—ã, –ø—Ä–∏–±—ã–ª—å
‚Ä¢ –¢–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏: –º–µ—Å—è—Ü X –ø—Ä–∏ Y –∫–ª–∏–µ–Ω—Ç–∞—Ö
‚Ä¢ –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±—é–¥–∂–µ—Ç: $X (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)

[–†–ò–°–ö–ò]
| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
(5 —Ä–∏—Å–∫–æ–≤)

[–î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê]
–ú–µ—Å—è—Ü 1 ‚Üí –ú–µ—Å—è—Ü 3 ‚Üí –ú–µ—Å—è—Ü 6 ‚Üí –ú–µ—Å—è—Ü 12

[–°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì]
–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ì–û–î–ù–Ø –∑–∞ 1 —á–∞—Å.

–ü–†–ê–í–ò–õ–ê:
- –í—Å–µ —Ü–∏—Ñ—Ä—ã –æ–±–æ—Å–Ω–æ–≤–∞–Ω—ã
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è 1 —á–µ–ª–æ–≤–µ–∫–∞ —Å $500
- –ù–µ "—ç—Ç–æ –∑–∞–≤–∏—Å–∏—Ç" ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    },
    "researcher": {
        "name": "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å",
        "icon": "üîç",
        "color": "#3fb950",
        "prompt": """–†–û–õ–¨: –ê–Ω–∞–ª–∏—Ç–∏–∫ —Ä—ã–Ω–∫–∞, 15 –ª–µ—Ç –æ–ø—ã—Ç–∞ –≤ market research.

–ê–õ–ì–û–†–ò–¢–ú:

[–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï]
–ù–∏—à–∞: —Ä–∞–∑–º–µ—Ä –≤ $, —Å—Ç–∞–¥–∏—è (–∑–∞—Ä–æ–∂–¥–µ–Ω–∏–µ/—Ä–æ—Å—Ç/–∑—Ä–µ–ª–æ—Å—Ç—å/—É–ø–∞–¥–æ–∫), —Ä–æ—Å—Ç –≤ %, –¥—Ä–∞–π–≤–µ—Ä—ã.

[–ê–£–î–ò–¢–û–†–ò–Ø]
3 —Å–µ–≥–º–µ–Ω—Ç–∞. –î–ª—è –∫–∞–∂–¥–æ–≥–æ:
‚Ä¢ –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è: –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –¥–æ—Ö–æ–¥, –≥–µ–æ–≥—Ä–∞—Ñ–∏—è
‚Ä¢ –¢–æ–ø-3 –±–æ–ª–∏
‚Ä¢ –ë—é–¥–∂–µ—Ç –≤ –º–µ—Å—è—Ü
‚Ä¢ –ü–ª–æ—â–∞–¥–∫–∏ –≥–¥–µ –æ–±–∏—Ç–∞—é—Ç

[–ö–û–ù–ö–£–†–ï–ù–¢–´]
| –ù–∞–∑–≤–∞–Ω–∏–µ | –í—ã—Ä—É—á–∫–∞ | –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã | –°–ª–∞–±–æ—Å—Ç–∏ | –¶–µ–Ω—ã |
(5 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤)

[–¢–†–ï–ù–î–´]
5 —Ç—Ä–µ–Ω–¥–æ–≤: —á—Ç–æ, –ø–æ—á–µ–º—É, —Ü–∏—Ñ—Ä—ã, –≤–ª–∏—è–Ω–∏–µ

[–ë–û–õ–ò]
| –ë–æ–ª—å | –ú–∞—Å—à—Ç–∞–± | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–∏—Ç—å (1-10) | –ü–ª–æ—Ö–∏–µ —Ä–µ—à–µ–Ω–∏—è |
(5 –±–æ–ª–µ–π)

[–í–´–í–û–î]
–í—Ö–æ–¥–∏—Ç—å –∏–ª–∏ –Ω–µ—Ç. –ï—Å–ª–∏ –¥–∞: —É–≥–æ–ª –≤—Ö–æ–¥–∞, —Å–µ–≥–º–µ–Ω—Ç, –ø–µ—Ä–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç.

–ü–†–ê–í–ò–õ–ê:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã: $, %, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –†–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
- –ß—ë—Ç–∫–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    },
    "strategist": {
        "name": "–°—Ç—Ä–∞—Ç–µ–≥",
        "icon": "üéØ",
        "color": "#f59e0b",
        "prompt": """–†–û–õ–¨: –ë–∏–∑–Ω–µ—Å-—Å—Ç—Ä–∞—Ç–µ–≥, 50+ —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤ –æ—Ç –∏–¥–µ–∏ –¥–æ $10M ARR.

–ê–õ–ì–û–†–ò–¢–ú:

[–ü–†–û–ë–õ–ï–ú–ê]
1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ + –º–∞—Å—à—Ç–∞–±: —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π, —Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞—Ç—è—Ç –Ω–∞ –ø–ª–æ—Ö–∏–µ —Ä–µ—à–µ–Ω–∏—è.

[–†–ï–®–ï–ù–ò–ï]
‚Ä¢ –ü—Ä–æ–¥—É–∫—Ç –≤ 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
‚Ä¢ 3 –æ—Ç–ª–∏—á–∏—è –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
‚Ä¢ –ü–æ—á–µ–º—É –°–ï–ô–ß–ê–°

[–ú–û–î–ï–õ–¨]
‚Ä¢ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è + –ø–æ—á–µ–º—É —ç—Ç–∞
‚Ä¢ 3 —Ç–∞—Ä–∏—Ñ–∞ —Å —Ü–µ–Ω–∞–º–∏
‚Ä¢ Upsell —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

[UNIT-–≠–ö–û–ù–û–ú–ò–ö–ê]
CAC: $X ‚Äî —Ä–∞—Å—á—ë—Ç
LTV: $X ‚Äî —Ä–∞—Å—á—ë—Ç
LTV/CAC: X
–ú–∞—Ä–∂–∞: X%
Payback: X –º–µ—Å—è—Ü–µ–≤

[MVP]
–ù–µ–¥–µ–ª—è 1: [–∑–∞–¥–∞—á–∏ –ø–æ –¥–Ω—è–º]
–ù–µ–¥–µ–ª—è 2: [–∑–∞–¥–∞—á–∏ –ø–æ –¥–Ω—è–º]
–¶–µ–ª—å: –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—è—â–∏–π –∫–ª–∏–µ–Ω—Ç

[GROWTH]
‚Ä¢ 0‚Üí100: [–∫–∞–Ω–∞–ª –∏ —Ç–∞–∫—Ç–∏–∫–∞]
‚Ä¢ 100‚Üí1000: [–∫–∞–Ω–∞–ª –∏ —Ç–∞–∫—Ç–∏–∫–∞]
‚Ä¢ 1000‚Üí10000: [–∫–∞–Ω–∞–ª –∏ —Ç–∞–∫—Ç–∏–∫–∞]

[–†–ò–°–ö–ò]
3 —Ä–∏—Å–∫–∞ + –ø–ª–∞–Ω B –¥–ª—è –∫–∞–∂–¥–æ–≥–æ

–ü–†–ê–í–ò–õ–ê:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã
- –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–º–ø–∞–Ω–∏–π
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    },
    "marketer": {
        "name": "–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥",
        "icon": "üì¢",
        "color": "#ec4899",
        "prompt": """–†–û–õ–¨: –î–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É, 30+ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ —Ä—ã–Ω–æ–∫. –ë—é–¥–∂–µ—Ç—ã –æ—Ç $0 –¥–æ $1M.

–ê–õ–ì–û–†–ò–¢–ú:

[–ü–û–ó–ò–¶–ò–û–ù–ò–†–û–í–ê–ù–ò–ï]
‚Ä¢ –£–¢–ü: "–î–ª—è [–∫–æ–≥–æ] –∫–æ—Ç–æ—Ä—ã–π [–±–æ–ª—å], –Ω–∞—à [–ø—Ä–æ–¥—É–∫—Ç] –¥–∞—ë—Ç [—Ä–µ–∑—É–ª—å—Ç–∞—Ç] –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç [–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç]"
‚Ä¢ –°–ª–æ–≥–∞–Ω
‚Ä¢ Tone of voice

[–ö–ê–ù–ê–õ–´]
| –ö–∞–Ω–∞–ª | –ë—é–¥–∂–µ—Ç/–º–µ—Å | CAC | –î–µ–π—Å—Ç–≤–∏—è | –ö–ª–∏–µ–Ω—Ç—ã |
(5 –∫–∞–Ω–∞–ª–æ–≤)

[–ö–û–ù–¢–ï–ù–¢-–ü–õ–ê–ù]
| –î–µ–Ω—å | –ü–ª–æ—â–∞–¥–∫–∞ | –¢–µ–º–∞ | –§–æ—Ä–º–∞—Ç | –¶–µ–ª—å |
(14 –¥–Ω–µ–π)

[–í–û–†–û–ù–ö–ê]
–£–≤–∏–¥–µ–ª–∏ (X) ‚Üí –ö–ª–∏–∫–Ω—É–ª–∏ (X%) ‚Üí –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å (X%) ‚Üí Trial (X%) ‚Üí –ö—É–ø–∏–ª–∏ (X%)

[–õ–ï–ù–î–ò–ù–ì]
‚Ä¢ Hero: –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
‚Ä¢ Problem: 3 –±–æ–ª–∏
‚Ä¢ Solution: —Ä–µ—à–µ–Ω–∏–µ
‚Ä¢ Benefits: 3 –≤—ã–≥–æ–¥—ã
‚Ä¢ Social proof: –ø—Ä–∏–º–µ—Ä—ã –æ—Ç–∑—ã–≤–æ–≤
‚Ä¢ CTA: –∫–Ω–æ–ø–∫–∞
‚Ä¢ FAQ: 5 –≤–æ–ø—Ä–æ—Å–æ–≤

[–ó–ê–ü–£–°–ö ‚Äî 7 –î–ù–ï–ô]
–î–µ–Ω—å 1-7: –ø–æ –¥–Ω—è–º —á—Ç–æ –¥–µ–ª–∞–µ–º

[–ú–ï–¢–†–ò–ö–ò]
| KPI | –¶–µ–ª—å | –ö–∞–∫ –∏–∑–º–µ—Ä—è—Ç—å |
(5 KPI)

–ü–†–ê–í–ò–õ–ê:
- –¢–µ–∫—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é
- AIDA, PAS, JTBD
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    },
    "developer": {
        "name": "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
        "icon": "üíª",
        "color": "#3b82f6",
        "prompt": """–†–û–õ–¨: Full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, 12 –ª–µ—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –±—ã—Å—Ç—Ä—ã–π MVP.

–ü–†–ò–ù–¶–ò–ü–´:
- –ú–∏–Ω–∏–º—É–º –∫–æ–¥–∞, –º–∞–∫—Å–∏–º—É–º –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–µ–∫: Render/Vercel + SQLite/Supabase
- –ü–æ—Å–∏–ª—å–Ω–æ –æ–¥–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É

–ê–õ–ì–û–†–ò–¢–ú:

[–ê–†–•–ò–¢–ï–ö–¢–£–†–ê]
–°—Ç–µ–∫: —è–∑—ã–∫, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –ë–î, —Ö–æ—Å—Ç–∏–Ω–≥ + –ø–æ—á–µ–º—É

[–°–¢–†–£–ö–¢–£–†–ê]
project/
‚îú‚îÄ‚îÄ –ø–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤

[–ö–û–ú–ü–û–ù–ï–ù–¢–´]
| –ú–æ–¥—É–ª—å | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |

[–ö–û–î]
–ö–ª—é—á–µ–≤–æ–π –†–ê–ë–û–ß–ò–ô –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

[API]
| API | –î–ª—è —á–µ–≥–æ | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |

[–î–ï–ü–õ–û–ô]
–ü–æ—à–∞–≥–æ–≤–æ –æ—Ç –ø—É—Å—Ç–æ–π –ø–∞–ø–∫–∏ –¥–æ URL

[–¢–ï–°–¢–´]
–ß—Ç–æ –∏ –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

[–°–†–û–ö–ò]
| –ó–∞–¥–∞—á–∞ | –ß–∞—Å—ã | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |

–ü–†–ê–í–ò–õ–ê:
- –ö–æ–¥ –†–ê–ë–û–ß–ò–ô
- Python + Flask
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    },
    "sales": {
        "name": "–ü—Ä–æ–¥–∞–∂–Ω–∏–∫",
        "icon": "ü§ù",
        "color": "#ef4444",
        "prompt": """–†–û–õ–¨: –î–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º, 15 –ª–µ—Ç, 1000+ —Å–¥–µ–ª–æ–∫. SPIN, Challenger Sale, MEDDIC.

–ê–õ–ì–û–†–ò–¢–ú:

[–ü–†–û–î–£–ö–¢]
"–í—ã –ø–æ–ª—É—á–∏—Ç–µ [—Ä–µ–∑—É–ª—å—Ç–∞—Ç] –∑–∞ [–≤—Ä–µ–º—è] –±–µ–∑ [–±–æ–ª—å]"
Elevator pitch: 30 —Å–µ–∫—É–Ω–¥

[–ê–í–ê–¢–ê–†]
‚Ä¢ –ò–º—è, –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –∫–æ–º–ø–∞–Ω–∏—è, –¥–æ—Ö–æ–¥
‚Ä¢ –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ —Å—Ç—Ä–∞—Ö–∏
‚Ä¢ –ì–¥–µ –Ω–∞–π—Ç–∏

[–ü–ï–†–í–´–ô –ö–û–ù–¢–ê–ö–¢]
3 –≥–æ—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞:
1. Cold email (—Ç–µ–º–∞ + —Ç–µ–∫—Å—Ç)
2. LinkedIn —Å–æ–æ–±—â–µ–Ω–∏–µ
3. DM –≤ Telegram

[–ü–†–ï–ó–ï–ù–¢–ê–¶–ò–Ø]
10 —Å–ª–∞–π–¥–æ–≤:
–°–ª–∞–π–¥ 1-10: [—á—Ç–æ –Ω–∞ —Å–ª–∞–π–¥–µ + —á—Ç–æ –≥–æ–≤–æ—Ä–∏–º]

[–í–û–ó–†–ê–ñ–ï–ù–ò–Ø]
| –í–æ–∑—Ä–∞–∂–µ–Ω–∏–µ | –û—Ç–≤–µ—Ç (–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è ‚Üí –£—Ç–æ—á–Ω–∏—Ç—å ‚Üí –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å ‚Üí –î–æ–∫–∞–∑–∞—Ç—å) |
(10 —à—Ç—É–∫)

[–ó–ê–ö–†–´–¢–ò–ï]
5 —Ç–µ—Ö–Ω–∏–∫ —Å —Ç–æ—á–Ω—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏

[FOLLOW-UP]
–î–µ–Ω—å 1: —Ç–µ–º–∞ + —Ç–µ–∫—Å—Ç
–î–µ–Ω—å 3: —Ç–µ–º–∞ + —Ç–µ–∫—Å—Ç
–î–µ–Ω—å 7: —Ç–µ–º–∞ + —Ç–µ–∫—Å—Ç
–î–µ–Ω—å 14: —Ç–µ–º–∞ + —Ç–µ–∫—Å—Ç
–î–µ–Ω—å 30: —Ç–µ–º–∞ + —Ç–µ–∫—Å—Ç

–ü–†–ê–í–ò–õ–ê:
- –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
- –ü–æ-—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏, –Ω–µ –∫–∞–∫ —Ä–æ–±–æ—Ç
- SPIN
- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    }
}


conversations = {}
projects = {}
last_request_time = {}
system_memory = {
    "niches_analyzed": [],
    "best_ideas": [],
    "lessons_learned": []
}


def get_history(session_id):
    if session_id not in conversations:
        conversations[session_id] = []
    return conversations[session_id]


def get_project(project_id):
    if project_id not in projects:
        projects[project_id] = {"knowledge_base": [], "tasks_done": [], "scans": []}
    return projects[project_id]


def clean_response(reply):
    if "<think>" in reply:
        parts = reply.split("</think>")
        if len(parts) > 1:
            reply = parts[-1].strip()
    return reply


@app.route("/")
def index():
    return render_template("index.html")


@app.route("/api/agents", methods=["GET"])
def get_agents():
    result = {}
    for key, agent in AGENTS.items():
        if key == "router":
            continue
        result[key] = {
            "name": agent["name"],
            "icon": agent["icon"],
            "color": agent["color"]
        }
    return jsonify(result)


@app.route("/api/chat", methods=["POST"])
def chat():
    data = request.json
    user_message = data.get("message", "").strip()
    session_id = data.get("session_id", "default")
    agent_id = data.get("agent", "strategist")
    project_id = data.get("project", "default")
    history_from_client = data.get("history", [])
    auto_route = data.get("auto_route", False)

    if not user_message:
        return jsonify({"error": "–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"}), 400

    now = time.time()
    if session_id in last_request_time:
        diff = now - last_request_time[session_id]
        if diff < 3:
            return jsonify({"error": f"–ü–æ–¥–æ–∂–¥–∏ {int(3 - diff)} —Å–µ–∫."}), 429
    last_request_time[session_id] = now

    project = get_project(project_id)
    routed_agent = agent_id
    route_info = None

    if auto_route:
        try:
            route_response = smart_completion(
                [
                    {"role": "system", "content": AGENTS["router"]["prompt"]},
                    {"role": "user", "content": user_message}
                ],
                "fast"
            )
            route_text = route_response.choices[0].message.content
            try:
                clean = route_text.strip()
                if "```" in clean:
                    clean = clean.split("```json")[-1].split("```")[0].strip()
                if "<think>" in clean:
                    clean = clean.split("</think>")[-1].strip()
                start = clean.find("{")
                end = clean.rfind("}") + 1
                if start >= 0 and end > start:
                    clean = clean[start:end]
                route_data = json.loads(clean)
                if "agent" in route_data:
                    routed_agent = route_data["agent"]
                    route_info = route_data
            except json.JSONDecodeError:
                pass
        except Exception:
            pass

    agent = AGENTS.get(routed_agent, AGENTS["strategist"])

    try:
        server_history = get_history(session_id)
        if not server_history and history_from_client:
            server_history.extend(history_from_client)
            conversations[session_id] = server_history

        context = ""
        if project["knowledge_base"]:
            last_entries = project["knowledge_base"][-5:]
            context = "\n\n[–ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê ‚Äî –¥–∞–Ω–Ω—ã–µ –æ—Ç –¥—Ä—É–≥–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤]:\n"
            for entry in last_entries:
                context += f"‚Äî {entry['agent']}: {entry['summary'][:300]}\n"
            context += "\n[–ò–°–ü–û–õ–¨–ó–£–ô –≠–¢–ò –î–ê–ù–ù–´–ï]\n\n"

        if system_memory["niches_analyzed"]:
            context += "\n[–ü–ê–ú–Ø–¢–¨ ‚Äî –ø—Ä–æ—à–ª—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è]:\n"
            for mem in system_memory["niches_analyzed"][-3:]:
                context += f"‚Äî {mem['content'][:200]}\n"
            context += "\n"

        enriched = context + user_message if context else user_message
        server_history.append({"role": "user", "content": enriched})

        messages = [{"role": "system", "content": agent["prompt"]}] + server_history

        task_type = AGENT_TASK_TYPE.get(routed_agent, "default")
        response = smart_completion(messages, task_type)

        reply = clean_response(response.choices[0].message.content)

        server_history.append({"role": "assistant", "content": reply})

        project["knowledge_base"].append({
            "agent": agent["name"],
            "agent_id": routed_agent,
            "summary": reply[:500],
            "timestamp": time.time()
        })

        if routed_agent == "scanner":
            system_memory["niches_analyzed"].append({
                "content": f"–ù–∏—à–∞: {user_message[:100]} | {reply[:200]}",
                "timestamp": time.time()
            })
        elif routed_agent == "idea_generator":
            system_memory["best_ideas"].append({
                "content": reply[:300],
                "timestamp": time.time()
            })

        if len(system_memory["niches_analyzed"]) > 20:
            system_memory["niches_analyzed"] = system_memory["niches_analyzed"][-20:]
        if len(system_memory["best_ideas"]) > 20:
            system_memory["best_ideas"] = system_memory["best_ideas"][-20:]

        if len(server_history) > 30:
            server_history[:] = server_history[-30:]

        result = {
            "response": reply,
            "agent": routed_agent,
            "agent_name": agent["name"],
            "agent_icon": agent["icon"],
            "agent_color": agent["color"],
            "status": "ok"
        }
        if route_info:
            result["route_info"] = route_info

        return jsonify(result)

    except Exception as e:
        error_msg = str(e)
        if "rate_limit" in error_msg.lower() or "429" in error_msg:
            return jsonify({"error": "–ü–æ–¥–æ–∂–¥–∏ –º–∏–Ω—É—Ç—É ‚Äî –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤."}), 429
        return jsonify({"error": error_msg}), 500


@app.route("/api/chain", methods=["POST"])
def chain():
    data = request.json
    user_message = data.get("message", "").strip()
    chain_agents = data.get("chain", [])
    project_id = data.get("project", "default")

    if not user_message:
        return jsonify({"error": "–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"}), 400

    project = get_project(project_id)
    results = []

    for agent_id in chain_agents:
        agent = AGENTS.get(agent_id)
        if not agent:
            continue

        try:
            context = ""
            if results:
                context = "\n\n[–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–ï–î–´–î–£–©–ò–• –ê–ì–ï–ù–¢–û–í]:\n"
                for r in results:
                    context += f"\n--- {r['agent_name']} ---\n{r['response'][:1500]}\n"
                context += "\n[–ù–ê –û–°–ù–û–í–ï –≠–¢–ò–• –î–ê–ù–ù–´–• –í–´–ü–û–õ–ù–ò –°–í–û–Æ –ó–ê–î–ê–ß–£]\n\n"

            messages = [
                {"role": "system", "content": agent["prompt"]},
                {"role": "user", "content": context + user_message}
            ]

            task_type = AGENT_TASK_TYPE.get(agent_id, "default")
            response = smart_completion(messages, task_type)
            reply = clean_response(response.choices[0].message.content)

            project["knowledge_base"].append({
                "agent": agent["name"],
                "agent_id": agent_id,
                "summary": reply[:500],
                "timestamp": time.time()
            })

            results.append({
                "agent": agent_id,
                "agent_name": agent["name"],
                "agent_icon": agent["icon"],
                "agent_color": agent["color"],
                "response": reply
            })

            time.sleep(2)

        except Exception as e:
            results.append({
                "agent": agent_id,
                "agent_name": agent["name"],
                "agent_icon": agent.get("icon", "?"),
                "agent_color": agent.get("color", "#fff"),
                "response": f"–û—à–∏–±–∫–∞: {str(e)}"
            })
            break

    return jsonify({"results": results, "status": "ok"})


@app.route("/api/fullcycle", methods=["POST"])
def fullcycle():
    data = request.json
    niche = data.get("niche", "").strip()
    project_id = data.get("project", "default")

    if not niche:
        return jsonify({"error": "–£–∫–∞–∂–∏ –Ω–∏—à—É"}), 400

    project = get_project(project_id)
    results = []

    steps = [
        ("scanner", f"–ü—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–π –≤—Å–µ —Å–æ—Ü—Å–µ—Ç–∏ –∏ –Ω–∞–π–¥–∏ –±–æ–ª–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –≤ –Ω–∏—à–µ: {niche}. –ë—É–¥—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ subreddit-—ã, —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã, —Ä–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã."),
        ("idea_generator", None),
        ("business_plan", None)
    ]

    for i, (agent_id, custom_msg) in enumerate(steps):
        agent = AGENTS[agent_id]

        try:
            context = ""
            if results:
                context = "\n\n[–î–ê–ù–ù–´–ï –û–¢ –ü–†–ï–î–´–î–£–©–ò–• –ê–ì–ï–ù–¢–û–í]:\n"
                for r in results:
                    context += f"\n--- {r['agent_name']} ---\n{r['response'][:2000]}\n"
                context += "\n[–ù–ê –û–°–ù–û–í–ï –≠–¢–ò–• –î–ê–ù–ù–´–• –í–´–ü–û–õ–ù–ò –°–í–û–Æ –ó–ê–î–ê–ß–£]\n\n"

            if custom_msg:
                msg = custom_msg
            else:
                msg = f"–ù–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤—ã—à–µ –≤—ã–ø–æ–ª–Ω–∏ —Å–≤–æ—é –∑–∞–¥–∞—á—É –¥–ª—è –Ω–∏—à–∏: {niche}. –í—ã–±–µ—Ä–∏ –õ–£–ß–®–£–Æ –∏–¥–µ—é –∏ —Å–¥–µ–ª–∞–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç."

            messages = [
                {"role": "system", "content": agent["prompt"]},
                {"role": "user", "content": context + msg}
            ]

            task_type = AGENT_TASK_TYPE.get(agent_id, "default")
            response = smart_completion(messages, task_type)
            reply = clean_response(response.choices[0].message.content)

            project["knowledge_base"].append({
                "agent": agent["name"],
                "agent_id": agent_id,
                "summary": reply[:500],
                "timestamp": time.time()
            })

            system_memory["niches_analyzed"].append({
                "content": f"–ù–∏—à–∞: {niche} | –ê–≥–µ–Ω—Ç: {agent['name']} | {reply[:200]}",
                "timestamp": time.time()
            })

            results.append({
                "agent": agent_id,
                "agent_name": agent["name"],
                "agent_icon": agent["icon"],
                "agent_color": agent["color"],
                "response": reply,
                "step": i + 1
            })

            time.sleep(2)

        except Exception as e:
            results.append({
                "agent": agent_id,
                "agent_name": agent["name"],
                "agent_icon": agent["icon"],
                "agent_color": agent["color"],
                "response": f"–û—à–∏–±–∫–∞: {str(e)}",
                "step": i + 1
            })
            break

    return jsonify({"results": results, "niche": niche, "status": "ok"})


@app.route("/api/reset", methods=["POST"])
def reset():
    data = request.json
    session_id = data.get("session_id", "default")
    project_id = data.get("project", None)
    if session_id in conversations:
        del conversations[session_id]
    if project_id and project_id in projects:
        del projects[project_id]
    return jsonify({"status": "reset"})


@app.route("/api/memory", methods=["GET"])
def get_memory():
    return jsonify(system_memory)


@app.route("/api/templates", methods=["GET"])
def get_templates():
    templates = [
        {"title": "/scan", "prompt": "–ü—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–π —Å–æ—Ü—Å–µ—Ç–∏ –≤ –Ω–∏—à–µ: ", "desc": "üì° Reddit, YouTube, Twitter"},
        {"title": "/ideas", "prompt": "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –±–∏–∑–Ω–µ—Å-–∏–¥–µ–∏ –¥–ª—è: ", "desc": "üí° 5 –∏–¥–µ–π —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏"},
        {"title": "/plan", "prompt": "–ë–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω –¥–ª—è: ", "desc": "üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω"},
        {"title": "/fullcycle", "prompt": "", "desc": "üöÄ –°–∫–∞–Ω ‚Üí –ò–¥–µ–∏ ‚Üí –ü–ª–∞–Ω"},
        {"title": "/research", "prompt": "–ò—Å—Å–ª–µ–¥—É–π –Ω–∏—à—É: ", "desc": "üîç –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞"},
        {"title": "/landing", "prompt": "–õ–µ–Ω–¥–∏–Ω–≥ –¥–ª—è: ", "desc": "üìù –ü—Ä–æ–¥–∞—é—â–∏–π —Ç–µ–∫—Å—Ç"},
        {"title": "/funnel", "prompt": "–í–æ—Ä–æ–Ω–∫–∞ –¥–ª—è: ", "desc": "üì¢ –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂"},
        {"title": "/script", "prompt": "–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–¥–∞–∂ –¥–ª—è: ", "desc": "ü§ù –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã"},
        {"title": "/mvp", "prompt": "MVP –¥–ª—è: ", "desc": "üíª –¢–µ—Ö—Ä–µ—à–µ–Ω–∏–µ"}
    ]
    return jsonify(templates)


if __name__ == "__main__":
    app.run(debug=True, port=5000)
